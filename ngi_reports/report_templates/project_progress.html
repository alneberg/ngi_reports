<!DOCTYPE html>
<html{% if lang is defined%} lang="{{ lang }}" {% endif %}>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Markdown">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,{{ include_file('project_progress_assets/img/NGI-square-icon.png', b64=True) }}"/>
  <title>{% if meta.subtitle %} {{ meta.subtitle }} - {% endif %} {% if meta.title %}{{ meta.title }}{% endif %}</title>

  <!-- Bootstrap CSS -->
  <style type="text/css">
    {{ include_file('project_progress_assets/css/bootstrap.min.css') }}
  </style>

  <style type="text/css">

  /********************************************************
  * Common Typography
  *********************************************************/

  /********************************************************
  * Specific Elements, in order of appearance..
  *********************************************************/
  /* Main container */
  .container {
    /* max-width: 960px; */
  }

  /* Page Header */
  .page_header {
    color:#999999;
    font-size:12px;
    text-align:center;
    margin:15px 0;
    padding-bottom:15px;
    border-bottom:1px solid #999;
  }

  /* Page Title Section */
  header {
    border-bottom:1px solid #999;
    margin-bottom:15px;
    padding-bottom:15px;
  }
  h1.title, h1.subtitle, h1.aborted{
    font-weight: normal;
    text-align: center;
    margin:0;
  }
  h1.title {
    font-size:24pt;
  }
  h1.subtitle {
    font-size:18pt;
    margin-top:10px;
  }
  h3.date {
    display:none;
  }

  .swedac_logo {
    float:right;
    padding-left: 15px;
  }

  /* Cards */
  .card_collapse_link {
    text-decoration: none;
    color: black;
  }

  .table {
    font-size: 13px;
  }

  .text_nowrap {
    white-space: nowrap;
  }

  /* Page Footer */
  footer {
    border-top: 1px solid #999;
    margin:30px 0;
    padding-top:15px;
    color:#999999;
    font-size:12px;
    text-align:right;
  }
  footer a {
    color:#999999;
    text-decoration:none;
  }

</style>

<body>
  <div class="container">
    <div class="page_header mt-5">
      <div class="d-flex flex-row">
        <a class="me-auto" href="http://www.scilifelab.se" target="_blank"><img title="Science for Life Laboratory" src="data:image/png;base64, {{ include_file('project_progress_assets/img/SciLifeLab.png', b64=True) }}"></a>
        <a class="" href="https://ngisweden.scilifelab.se/" target="_blank"><img title="National Genomics Infrastructure" src="data:image/png;base64, {{ include_file('project_progress_assets/img/NGI.png', b64=True) }}"></a>
      </div>
      National Genomics Infrastructure - Project Progress
    </div>


    <header>
      {% if meta.title %}<h1 class="title">{{ meta.title }}</h1>{% endif %}
      {% if meta.subtitle %}<h1 class="subtitle">{{ meta.subtitle }}</h1>{% endif %}
      {% if project.aborted %}<h1 class="aborted text-danger">Aborted</h1>{% endif %}
      {% if meta.date %}<h3 class="date">{{ meta.date }}</h3>{% endif %}
    </header>

    <div class="card">
      <div class="card-header">
        <a class="card_collapse_link" data-bs-toggle="collapse" data-bs-target="#reception_control_card_body" role="button" aria-expanded="false" aria-controls="#reception_control_card_body">
          <h3>Reception Control</h3>
          <div class="progress">
            <div class="progress-bar {{ meta['RC_progress_class'] }}" role="progressbar" style="width: {{ meta['RC_progress_width'] }}%" aria-valuenow="{{ meta['RC_progress_width'] }}" aria-valuemin="0" aria-valuemax="100">{{ meta['RC_passed'] }}/{{ meta['nr_samples'] }}</div>
          </div>
        </a>

      </div>
      <div class="collapse" id="reception_control_card_body">
        <div class="card-body">
            <button class="btn btn-outline-dark mr-2" data-bs-toggle="modal" data-bs-target="#configure_RC_columns">Configure Columns</button>
            <span>Currently showing <span id="RC_table_numcols"></span> columns out of {{ meta['RC_columns'].keys() | length }}.</span>
          <div class="modal fade" id="configure_RC_columns" tabindex="-1" aria-labelledby="configure_RC_columns_label" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="configure_RC_columns_label">Configure columns for reception control table</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <button class="btn btn-outline-dark configModal_bulkVisible" data-action="showAll" data-target="#RC_table">Show all columns</button>
                  <button class="btn btn-outline-dark configModal_bulkVisible" data-action="showNone" data-target="#RC_table">Hide all columns</button>
                  <table class="table" id="RC_table_configModal_table">
                    <thead>
                      <tr>
                        <th scope="col">Include in table</th>
                        <th scope="col">Column Header</th>
                        <th scope="col">Explanation</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for attribute, table_field in meta['RC_columns'].items() %}
                        <tr class="{{ attribute }}">
                          <td>
                            <div class="form-check">
                              <input class="form-check-input table_col_visible" type="checkbox" value="{{ attribute }}" data-target="#RC_table" id="check_rc_columns_{{ attribute }}" {% if table_field.visible_by_default %} checked{% endif %}>
                            </div>
                          </td>
                          <th scope="row">{{ table_field.display_title }}</th>
                          <td scope="col">{{ table_field.explanation }}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

          <table class="table table-sm mt-2" id="RC_table">
            <thead>
              <tr>
                <th scope="col">ID</th>
                {% for attribute, table_field in meta['RC_columns'].items() %}
                  <th class="{{attribute}}" scope="col">{{ table_field.display_title }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for sample_id, sample in project.samples.items() %}
                <tr>
                  <th scope="row">{{ sample_id }}</th>
                  {% for attribute, column_dict in meta['RC_columns'].items() %}
                    <td class="{{attribute}} {{column_dict.get('custom_classes', '')}}" scope="col">{{ sample.attributes_as_dict()[attribute] }}</th>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>

        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <a class="card_collapse_link" data-bs-toggle="collapse" data-bs-target="#libprep_card_body" role="button" aria-expanded="false" aria-controls="#libprep_card_body">
          <h3 >Library Preparation</h3>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">170/200</div>
          </div>
        </a>
      </div>
      <div class="collapse" id="libprep_card_body">
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td colspan="2">Larry the Bird</td>
                <td>@twitter</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <a class="card_collapse_link" data-bs-toggle="collapse" data-bs-target="#sequencing_card_body" role="button" aria-expanded="false" aria-controls="#sequencing_card_body">
          <h3 >Sequencing</h3>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">150/200</div>
          </div>
        </a>
      </div>
      <div class="collapse" id="sequencing_card_body">
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td colspan="2">Larry the Bird</td>
                <td>@twitter</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <a class="card_collapse_link" data-bs-toggle="collapse" data-bs-target="#bioinfo_card_body" role="button" aria-expanded="false" aria-controls="#bioinfo_card_body">
          <h3 >Bioinformatics</h3>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100">55/200</div>
          </div>
        </a>
      </div>
      <div class="collapse" id="bioinfo_card_body">
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td colspan="2">Larry the Bird</td>
                <td>@twitter</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <a class="card_collapse_link" data-bs-toggle="collapse" data-bs-target="#data_delivery_card_body" role="button" aria-expanded="false" aria-controls="#data_delivery_card_body">
          <h3 >Data Delivery</h3>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25/200</div>
          </div>
        </a>
      </div>
      <div class="collapse" id="data_delivery_card_body">
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td colspan="2">Larry the Bird</td>
                <td>@twitter</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>


    <footer>
      <div class="d-flex flex-row">
        {% if meta.support_email %}
          <a class="me-auto" href="mailto:{{ meta.support_email }}">{{ meta.support_email }}</a>
        {% endif %}
        {% if meta.subtitle %}{{ meta.subtitle }}{% endif %}
      </div>
    </footer>
  </div>
  <script> {{ include_file('project_progress_assets/js/bootstrap.bundle.min.js') }}</script>
  <script> {{ include_file('project_progress_assets/js/jquery-3.6.0.min.js') }}</script>

  <script>
  $(document).ready(
    table_col_updateVisible('#RC_table')
  )

  /* Copied and modified from MultiQC https://github.com/ewels/multiqc, GPL-3.0 License */
  /////// COLUMN CONFIG
  // show + hide columns
  $('.table_col_visible').change(function(){
    var target = $(this).data('target');
    table_col_updateVisible(target);
  });

  // Bulk set visible / hidden
  $('.configModal_bulkVisible').click(function(e){
    e.preventDefault();
    var target = $(this).data('target');
    var visible = $(this).data('action') == 'showAll';
    $(target+'_configModal_table tbody .table_col_visible').prop('checked', visible);
    table_col_updateVisible(target);
  });

  function table_col_updateVisible(target){
    $(target+'_configModal_table .table_col_visible').each(function(){
      var cclass = $(this).val();

      if($(this).is(":checked")) {
        $(target+' .'+cclass).show();
        console.log("Checked! " + target+' .'+cclass);
        $(target+'_configModal_table .'+cclass).removeClass('text-muted');
      } else {
        $(target+' .'+cclass).hide();
        $(target+'_configModal_table .'+cclass).addClass('text-muted');
      }
    });

    // Update counts
    var visible_cols = $(target+' thead th').filter(function() { return $(this).css("display") != "none" });
    $(target+'_numcols').text( visible_cols.length - 1 );
  }
  </script>
</body>
</html>
